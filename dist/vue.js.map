{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["\r\nlet oldArrayProto = Array.prototype\r\n\r\nexport let newArrayProto = Object.create(oldArrayProto)\r\n\r\nlet methods = [\r\n  'push',\r\n  'pop',\r\n  'shift',\r\n  'unshift',\r\n  'reverse',\r\n  'sort',\r\n  'splice'\r\n]\r\n\r\nmethods.forEach(method =>{\r\n  newArrayProto[method] = function(...args) { // 这里重写了数组的方法\r\n    // 内部调用原来的方法\r\n    const result =  oldArrayProto[method].call(this, ...args)\r\n    console.log('arrayMethos', method)\r\n\r\n    // 我们需要对新增的数据再次进行劫持\r\n    let inserted;\r\n    let ob = this.__ob__;\r\n    switch (method) {\r\n      case 'push':\r\n      case 'unshift':\r\n        inserted = args\r\n        break;\r\n      case 'splice': \r\n        inserted = args.slice(2)\r\n      default:\r\n        break;\r\n    }\r\n\r\n    console.log('数组新增的内容', inserted)\r\n    // 如果数组新增的数据是对象类型，那么就重新进行劫持\r\n    if(inserted) {\r\n      ob.observeArray(inserted)\r\n    }\r\n\r\n    return result\r\n  }\r\n})","import { newArrayProto } from './array'\r\n\r\nclass Observer {\r\n  constructor(data) {\r\n    // Object.defineProperty只能劫持已经存在的属性，新增删除的属性并不能劫持到\r\n    // 对此，vue2里面会单独进行处理 $set $delete\r\n\r\n    data.__ob__ = this; // 给数据加了一个标识，如果数据上有__ob__，则说明这个属性被观测过\r\n    Object.defineProperty(data, '__ob__', {\r\n      value: this,\r\n      enumerable: false // 将 __ob__ 变成不可枚举（循环的时候无法获取到）\r\n    })\r\n    if(Array.isArray(data)) {\r\n      data.__proto__ = newArrayProto\r\n      this.observeArray(data) // 如果数组中放的是对象，可以监控到对象的变化\r\n    }else {\r\n      this.walk(data)\r\n    }\r\n  }\r\n\r\n  // 循环对象，对属性依此进行劫持\r\n  walk(data) {\r\n    // 重新定义属性\r\n    Object.keys(data).forEach(key => defineReactive(data, key, data[key]))\r\n  }\r\n  // 观测数组\r\n  observeArray(data) {\r\n    data.forEach(item => observe(item))\r\n  }\r\n}\r\n\r\nexport function defineReactive(target, key, value) {\r\n  observe(value) // 对所有的对象都进行劫持\r\n  Object.defineProperty(target, key, {\r\n    get() {\r\n      console.log('key', key)\r\n      return value\r\n    },\r\n    set(newValue) {\r\n      if(newValue === value) return\r\n      observe(newValue) // 修改的值如果是对象，就重新进行劫持\r\n      value = newValue\r\n    }\r\n  })\r\n}\r\n\r\n// 对data这个对象进行劫持\r\nexport function observe(data) {\r\n  // console.log(data)\r\n\r\n  if(typeof data !== 'object' || data === null) {\r\n    return // 只对对象进行劫持\r\n  }\r\n\r\n  if(data.__ob__ instanceof Observer) { // 说明这个对象被代理过了\r\n    return data.__ob__\r\n  }\r\n\r\n  // 如果一个对象被劫持过了，那就不需要再被劫持了\r\n  // 要判断一个对象是否被劫持过，可以添加一个实例，用实例来判断是否被劫持欧\r\n\r\n  return new Observer(data)\r\n}","import { observe } from \"./observe/index\"\r\n\r\nexport function initState(vm) {\r\n  const opts = vm.$options\r\n  if(opts.data) {\r\n    initData(vm)\r\n  }\r\n}\r\n\r\nfunction proxy(vm, target, key) {\r\n  Object.defineProperty(vm, key, { // vm.name\r\n    get() {\r\n      return vm[target][key] // vm._data.name\r\n    },\r\n    set(newValue) {\r\n      vm[target][key] = newValue\r\n    }\r\n  })\r\n}\r\n\r\nfunction initData(vm) {\r\n  let data = vm.$options.data\r\n  data = typeof data === 'function' ? data.call(vm) : data\r\n  \r\n  vm._data = data\r\n  observe(data)\r\n\r\n  // 将vm._data用vm来代理，使data中的数据可以直接通过vm.propertyKey访问\r\n  for(let key in data) {\r\n    proxy(vm, '_data', key)\r\n  }\r\n}","import {initState} from './state'\r\n\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function(options) {\r\n    const vm = this;\r\n    // vm.$options 就是获取用户的配置\r\n    vm.$options = options // 将用户的选项挂载到实例上\r\n\r\n    initState(vm)\r\n  }\r\n}\r\n","import {initMixin} from './init'\r\n\r\nfunction Vue(options) {\r\n  this._init(options)\r\n}\r\n\r\ninitMixin(Vue)\r\n\r\nexport default Vue"],"names":["oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","method","args","result","call","console","log","inserted","ob","__ob__","slice","observeArray","Observer","data","defineProperty","value","enumerable","isArray","__proto__","walk","keys","key","defineReactive","item","observe","target","get","set","newValue","initState","vm","opts","$options","initData","proxy","_data","initMixin","Vue","_init","options"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EACA,IAAIA,aAAa,GAAGC,KAAK,CAACC,SAA1B,CAAA;EAEO,IAAIC,aAAa,GAAGC,MAAM,CAACC,MAAP,CAAcL,aAAd,CAApB,CAAA;EAEP,IAAIM,OAAO,GAAG,CACZ,MADY,EAEZ,KAFY,EAGZ,OAHY,EAIZ,SAJY,EAKZ,SALY,EAMZ,MANY,EAOZ,QAPY,CAAd,CAAA;EAUAA,OAAO,CAACC,OAAR,CAAgB,UAAAC,MAAM,EAAG;EACvBL,EAAAA,aAAa,CAACK,MAAD,CAAb,GAAwB,YAAkB;EAAA,IAAA,IAAA,qBAAA,CAAA;;EAAA,IAAA,KAAA,IAAA,IAAA,GAAA,SAAA,CAAA,MAAA,EAANC,IAAM,GAAA,IAAA,KAAA,CAAA,IAAA,CAAA,EAAA,IAAA,GAAA,CAAA,EAAA,IAAA,GAAA,IAAA,EAAA,IAAA,EAAA,EAAA;QAANA,IAAM,CAAA,IAAA,CAAA,GAAA,SAAA,CAAA,IAAA,CAAA,CAAA;EAAA,KAAA;;EAAE;EAC1C;EACA,IAAA,IAAMC,MAAM,GAAI,CAAAV,qBAAAA,GAAAA,aAAa,CAACQ,MAAD,CAAb,EAAsBG,IAAtB,CAAA,KAAA,CAAA,qBAAA,EAAA,CAA2B,IAA3B,CAAA,CAAA,MAAA,CAAoCF,IAApC,CAAhB,CAAA,CAAA;;EACAG,IAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2BL,MAA3B,EAHwC;;EAMxC,IAAA,IAAIM,QAAJ,CAAA;MACA,IAAIC,EAAE,GAAG,IAAA,CAAKC,MAAd,CAAA;;EACA,IAAA,QAAQR,MAAR;EACE,MAAA,KAAK,MAAL,CAAA;EACA,MAAA,KAAK,SAAL;EACEM,QAAAA,QAAQ,GAAGL,IAAX,CAAA;EACA,QAAA,MAAA;;EACF,MAAA,KAAK,QAAL;EACEK,QAAAA,QAAQ,GAAGL,IAAI,CAACQ,KAAL,CAAW,CAAX,CAAX,CAAA;EANJ,KAAA;;EAWAL,IAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuBC,QAAvB,EAnBwC;;EAqBxC,IAAA,IAAGA,QAAH,EAAa;QACXC,EAAE,CAACG,YAAH,CAAgBJ,QAAhB,CAAA,CAAA;EACD,KAAA;;EAED,IAAA,OAAOJ,MAAP,CAAA;KAzBF,CAAA;EA2BD,CA5BD,CAAA;;MCbMS;EACJ,EAAA,SAAA,QAAA,CAAYC,IAAZ,EAAkB;EAAA,IAAA,eAAA,CAAA,IAAA,EAAA,QAAA,CAAA,CAAA;;EAChB;EACA;EAEAA,IAAAA,IAAI,CAACJ,MAAL,GAAc,IAAd,CAJgB;;EAKhBZ,IAAAA,MAAM,CAACiB,cAAP,CAAsBD,IAAtB,EAA4B,QAA5B,EAAsC;EACpCE,MAAAA,KAAK,EAAE,IAD6B;QAEpCC,UAAU,EAAE,KAFwB;;OAAtC,CAAA,CAAA;;EAIA,IAAA,IAAGtB,KAAK,CAACuB,OAAN,CAAcJ,IAAd,CAAH,EAAwB;QACtBA,IAAI,CAACK,SAAL,GAAiBtB,aAAjB,CAAA;EACA,MAAA,IAAA,CAAKe,YAAL,CAAkBE,IAAlB,CAAA,CAFsB;EAGvB,KAHD,MAGM;QACJ,IAAKM,CAAAA,IAAL,CAAUN,IAAV,CAAA,CAAA;EACD,KAAA;EACF;;;;;EAGD,IAAA,KAAA,EAAA,SAAA,IAAA,CAAKA,IAAL,EAAW;EACT;QACAhB,MAAM,CAACuB,IAAP,CAAYP,IAAZ,EAAkBb,OAAlB,CAA0B,UAAAqB,GAAG,EAAA;UAAA,OAAIC,cAAc,CAACT,IAAD,EAAOQ,GAAP,EAAYR,IAAI,CAACQ,GAAD,CAAhB,CAAlB,CAAA;SAA7B,CAAA,CAAA;EACD;;;;EAED,IAAA,KAAA,EAAA,SAAA,YAAA,CAAaR,IAAb,EAAmB;EACjBA,MAAAA,IAAI,CAACb,OAAL,CAAa,UAAAuB,IAAI,EAAA;UAAA,OAAIC,OAAO,CAACD,IAAD,CAAX,CAAA;SAAjB,CAAA,CAAA;EACD,KAAA;;;;;;EAGI,SAASD,cAAT,CAAwBG,MAAxB,EAAgCJ,GAAhC,EAAqCN,KAArC,EAA4C;EACjDS,EAAAA,OAAO,CAACT,KAAD,CAAP,CADiD;;EAEjDlB,EAAAA,MAAM,CAACiB,cAAP,CAAsBW,MAAtB,EAA8BJ,GAA9B,EAAmC;EACjCK,IAAAA,GADiC,EAC3B,SAAA,GAAA,GAAA;EACJrB,MAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ,EAAmBe,GAAnB,CAAA,CAAA;EACA,MAAA,OAAON,KAAP,CAAA;OAH+B;MAKjCY,GALiC,EAAA,SAAA,GAAA,CAK7BC,QAL6B,EAKnB;QACZ,IAAGA,QAAQ,KAAKb,KAAhB,EAAuB,OAAA;EACvBS,MAAAA,OAAO,CAACI,QAAD,CAAP,CAFY;;EAGZb,MAAAA,KAAK,GAAGa,QAAR,CAAA;EACD,KAAA;KATH,CAAA,CAAA;EAWD;;EAGM,SAASJ,OAAT,CAAiBX,IAAjB,EAAuB;EAC5B;IAEA,IAAG,OAAA,CAAOA,IAAP,CAAgB,KAAA,QAAhB,IAA4BA,IAAI,KAAK,IAAxC,EAA8C;EAC5C,IAAA,OAD4C;EAE7C,GAAA;;EAED,EAAA,IAAGA,IAAI,CAACJ,MAAL,YAAuBG,QAA1B,EAAoC;EAAE;MACpC,OAAOC,IAAI,CAACJ,MAAZ,CAAA;EACD,GAT2B;EAY5B;;;EAEA,EAAA,OAAO,IAAIG,QAAJ,CAAaC,IAAb,CAAP,CAAA;EACD;;EC5DM,SAASgB,SAAT,CAAmBC,EAAnB,EAAuB;EAC5B,EAAA,IAAMC,IAAI,GAAGD,EAAE,CAACE,QAAhB,CAAA;;IACA,IAAGD,IAAI,CAAClB,IAAR,EAAc;MACZoB,QAAQ,CAACH,EAAD,CAAR,CAAA;EACD,GAAA;EACF,CAAA;;EAED,SAASI,KAAT,CAAeJ,EAAf,EAAmBL,MAAnB,EAA2BJ,GAA3B,EAAgC;EAC9BxB,EAAAA,MAAM,CAACiB,cAAP,CAAsBgB,EAAtB,EAA0BT,GAA1B,EAA+B;EAAE;EAC/BK,IAAAA,GAD6B,EACvB,SAAA,GAAA,GAAA;QACJ,OAAOI,EAAE,CAACL,MAAD,CAAF,CAAWJ,GAAX,CAAP,CADI;OADuB;MAI7BM,GAJ6B,EAAA,SAAA,GAAA,CAIzBC,QAJyB,EAIf;EACZE,MAAAA,EAAE,CAACL,MAAD,CAAF,CAAWJ,GAAX,IAAkBO,QAAlB,CAAA;EACD,KAAA;KANH,CAAA,CAAA;EAQD,CAAA;;EAED,SAASK,QAAT,CAAkBH,EAAlB,EAAsB;EACpB,EAAA,IAAIjB,IAAI,GAAGiB,EAAE,CAACE,QAAH,CAAYnB,IAAvB,CAAA;EACAA,EAAAA,IAAI,GAAG,OAAOA,IAAP,KAAgB,UAAhB,GAA6BA,IAAI,CAACT,IAAL,CAAU0B,EAAV,CAA7B,GAA6CjB,IAApD,CAAA;IAEAiB,EAAE,CAACK,KAAH,GAAWtB,IAAX,CAAA;EACAW,EAAAA,OAAO,CAACX,IAAD,CAAP,CALoB;;EAQpB,EAAA,KAAI,IAAIQ,GAAR,IAAeR,IAAf,EAAqB;EACnBqB,IAAAA,KAAK,CAACJ,EAAD,EAAK,OAAL,EAAcT,GAAd,CAAL,CAAA;EACD,GAAA;EACF;;EC7BM,SAASe,SAAT,CAAmBC,GAAnB,EAAwB;EAC7BA,EAAAA,GAAG,CAAC1C,SAAJ,CAAc2C,KAAd,GAAsB,UAASC,OAAT,EAAkB;EACtC,IAAA,IAAMT,EAAE,GAAG,IAAX,CADsC;;EAGtCA,IAAAA,EAAE,CAACE,QAAH,GAAcO,OAAd,CAHsC;;MAKtCV,SAAS,CAACC,EAAD,CAAT,CAAA;KALF,CAAA;EAOD;;ECRD,SAASO,GAAT,CAAaE,OAAb,EAAsB;IACpB,IAAKD,CAAAA,KAAL,CAAWC,OAAX,CAAA,CAAA;EACD,CAAA;;EAEDH,SAAS,CAACC,GAAD,CAAT;;;;;;;;"}